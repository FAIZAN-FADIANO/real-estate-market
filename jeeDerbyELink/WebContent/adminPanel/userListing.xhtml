<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:b="http://bootsfaces.net/ui" xmlns:p="http://primefaces.org/ui"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:head></h:head>
<h:body>
  <ui:composition
    template="/WEB-INF/templates/adminPanel/basic/adminPanelTemplateBasic.xhtml">
    <ui:define name="title">#{userRB.listOfUsersMetaTitle}</ui:define>

    <ui:define name="content">
      <b:row>
        <b:column col-xs="12">
          <h1>
            <h:outputFormat
              value="#{adminPanelRB.userListingPageTopTitle}">
            </h:outputFormat>
          </h1>
        </b:column>
      </b:row>
      <b:row>
        <p:dataTable id="usersTable" var="user" rows="10"
          paginator="true" paginatorAlwaysVisible="false"
          resizableColumns="false" lazy="false" sortBy="#{user.type}"
          value="#{userController.usersList}" draggableRows="true"
          draggableColumns="false" rowsPerPageTemplate="5,10,20,50"
          rowsPerPageLabel="#{userRB.rowsPerPageLabel}" reflow="priority"
          emptyMessage="#{userRB.emptyMessage}">
          <f:facet name="header">
            <h:outputFormat value="#{userRB.listOfUsersTableTitle}">
              <f:param value="#{fn:length(userController.usersList)}"></f:param>
            </h:outputFormat>
            <p:commandButton styleClass="columnsToggler"
              id="userColumnsToggler" type="button"
              value="#{userRB.showColumnsLabel}" icon="fa fa-wrench"></p:commandButton>
            <p:columnToggler trigger="userColumnsToggler" datasource="usersTable">
              <p:ajax event="toggle" listener="#{userController.onUserTableToggle}"></p:ajax>
            </p:columnToggler>
          </f:facet>

          <p:column priority="1" toggleable="false" width="7%">
            <p:commandButton id="userInfoDetailsButton"
              icon="fa fa-search-plus" update="userInfoDetails"
              oncomplete="PF('userInfoOP').show('#{component.clientId}')">
              <f:setPropertyActionListener value="#{user}"
                target="#{userController.selectedUser}" />
            </p:commandButton>
            <p:tooltip for="userInfoDetailsButton" trackMouse="true">
              <p:graphicImage value="#{user.photo}" width="100px"></p:graphicImage>
            </p:tooltip>
          </p:column>

          <p:column headerText="#{userRB.userLastNameLabel}"
            priority="1" toggleable="false" width="18%" 
            sortBy="#{user.lastName}" >
            <h:outputText value="#{user.lastName}"></h:outputText>
          </p:column>
          <p:column headerText="#{userRB.userFirstNameLabel}"
            priority="1" width="15%" sortBy="#{user.firstName}"
            rendered="#{userController.usersTableColumnVisibility[2]}">
            <h:outputText value="#{user.firstName}"></h:outputText>
          </p:column>
          <p:column headerText="#{userRB.userTypeLabel}" priority="4"
            styleClass="userTypeCell" width="15%" 
            sortBy="#{user.type}"
            rendered="#{userController.usersTableColumnVisibility[3]}">
            <h:outputText value="#{user.type}"></h:outputText>
          </p:column>
          <p:column headerText="#{userRB.userLoginLabel}" priority="4"
            width="15%" rendered="#{userController.usersTableColumnVisibility[4]}">
            <h:outputText value="#{user.login}"></h:outputText>
          </p:column>
          <p:column headerText="#{userRB.userBirthdayLabel}"
            priority="5" width="15%" rendered="#{userController.usersTableColumnVisibility[5]}">
            <h:outputText value="#{user.birthday}">
              <f:convertDateTime pattern="dd.MM.yyyy" />
            </h:outputText>
          </p:column>
          <p:column headerText="#{userRB.userStatusLabel}" priority="2"
            width="15%" styleClass="userStatusCell" toggleable="false">
            <h:outputText value="#{user.status}"></h:outputText>
          </p:column>
        </p:dataTable>
      </b:row>

<!-- PopUped window with a user info details --> 
      <p:overlayPanel widgetVar="userInfoOP" showEffect="fade"
        hideEffect="fade" showCloseIcon="true"
        at="right bottom" my="left middle">
        <p:outputPanel id="userInfoDetails" styleClass="userListingPopupPanel">
          <p:panelGrid rendered="#{not empty userController.selectedUser}">
            <f:facet name="header">
              <p:graphicImage id="userPhoto" styleClass="userDetailsPhoto"
                value="#{userController.selectedUser.photo}" />
            </f:facet>

            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userFirstNameLabel}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.firstName}" />
              </p:column>
            </p:row>
            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userLastNameLabel}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.lastName}" />
              </p:column>
            </p:row>
            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userBirthdayLabel}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.birthday}">
                  <f:convertDateTime pattern="dd.MM.yyyy"/>
                </h:outputText>
              </p:column>
            </p:row>
            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userEmailLabel}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.email}" />
              </p:column>
            </p:row>
            <p:row
              rendered="${userController.selectedUser.type == 'REALTOR'}">
              <p:column>
                <h:outputText value="#{userRB.realtorSkypeLable}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.skype}" />
              </p:column>
            </p:row>
            <p:row
              rendered="${userController.selectedUser.type == 'REALTOR'}">
              <p:column>
                <h:outputText value="#{userRB.realtorPhoneNumbersLable}: " />
              </p:column>
              <p:column>
                <ul>
                  <ui:repeat var="phoneNumber" varStatus="status"
                    value="#{userController.selectedUser.phoneNumbers}">
                    <li>#{phoneNumber}</li>
                  </ui:repeat>
                </ul>
              </p:column>
            </p:row>
            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userTypeLabel}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.type}" />
              </p:column>
            </p:row>
            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userLoginLabel}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.login}" />
              </p:column>
            </p:row>
            <p:row>
              <p:column>
                <h:outputText value="#{userRB.userDateOfCreationLable}: " />
              </p:column>
              <p:column>
                <h:outputText
                  value="#{userController.selectedUser.dateOfCreation}">
                  <f:convertDateTime pattern="dd.MM.yyyy"/>
                </h:outputText>
              </p:column>
            </p:row>
          </p:panelGrid>
        </p:outputPanel>
      </p:overlayPanel>
    </ui:define>

  </ui:composition>
</h:body>
</html>